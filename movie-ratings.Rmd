---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r load the data}
movies.df <- read.delim(file = 'data/movies.dat', header = TRUE, sep = '\t')
userrated.movies.df <- read.delim(file = 'data/user_ratedmovies.dat', header = TRUE, sep = '\t')
```

```{r message=FALSE}
library(dplyr)
library(ggplot2)
library(reshape2)
```

```{r show the datasets}
#rename the id column to movieID so that it exactly matches the userrated.movies.df
movies.df <- movies.df %>% rename(movieID = id)

head(movies.df)
head(userrated.movies.df)

dim(movies.df)
dim(userrated.movies.df)
```

```{r merge the two datasets}
rated.movies.df <- merge(movies.df, userrated.movies.df, by='movieID')
```

```{r show the merged dataset}
head(rated.movies.df)

dim(rated.movies.df)
```

```{r calculate average rating by users and total ratings by user}
users.average <- aggregate(rated.movies.df$rating, list(rated.movies.df$userID), mean) %>% rename(Average.Rating = x, userID = Group.1)
users.total <- rated.movies.df %>% count(userID, sort = TRUE) %>% rename(Reviews = n) %>% as.data.frame()
users.stats <- merge(users.average, users.total, by='userID')

head(users.stats)

ggplot(users.stats, aes(x = Average.Rating)) + geom_histogram()
```

```{r calculate average rating and number of ratings per movie}
movies.total <- rated.movies.df %>% count(movieID, sort = TRUE) %>% rename(Ratings = n) %>% as.data.frame()
movies.average <- aggregate(rated.movies.df$rating, list(rated.movies.df$movieID), mean) %>% rename(Average.Rating = x, movieID = Group.1)

movies.stats <- merge(movies.average, movies.total, by='movieID')
ggplot(movies.stats, aes(x = Ratings)) + scale_x_continuous(trans="log10") + geom_density()
ggplot(movies.stats, aes(x = Ratings, y = Average.Rating)) + scale_x_continuous(trans="log10") + geom_point()
```